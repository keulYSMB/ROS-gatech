close all;
clear all;

%data = ones(20,2);
data2D = [1.0486 -0.3645 1;
    -1.6851 -0.4004 1;
    -0.9437 -0.4200 1;
    1.0682 0.0699 1;
    0.6077 -0.0771 1;
    1.2543 -0.6454 1;
    -0.2709 0.8635 1;
    -0.4571 -0.3645 1;
    -0.7902 0.0307 1;
    0.7318 0.6382 1;
    -1.0580 0.3312 1;
    0.3464 0.3377 1;
    0.3137 0.1189 1;
    -0.4310 0.0242 1;
    -0.4799 0.2920 1;
    0.6109 0.0830 1;
    -0.4081 0.2920 1;
    -0.1109 -0.2992 1;
    0.5129 -0.0575 1;
    0.1406 -0.4527 1];

data3D = [1.5706   -0.1490    0.2598 1;
   -1.5282    0.9695    0.3802 1;
   -0.6821    1.2856    0.4078 1;
   0.4124   -1.0201   -0.0915 1;
   1.2095    0.2812   -0.1280 1;
   0.8819   -0.8481    0.5255 1;
   -0.9442   -1.1583   -0.3759 1;
   0.0415    1.3445    0.3240 1;
   -0.7975    0.3017   -0.0826 1;
   -0.4329   -1.4151   -0.2774 1;
   -1.1475   -0.0772   -0.2667 1;
   -0.5149   -1.1784   -0.1401 1;
   0.1993   -0.2854   -0.2114 1;
   -0.4320    0.2143   -0.1053 1;
   -0.7481   -0.3840   -0.2408 1;
   0.8078   -0.1196   -0.2631 1;
   -0.7605   -0.5792   -0.1936 1;
   0.3237    0.7970    0.2170 1;
   1.3089    0.5786   -0.1887 1;
   1.2323    1.4421    0.4506 1
];
nbPoints = 20;
A=ones(2*nbPoints,12);
%%
k=1;
for i=1:nbPoints
    A(k,:) = [ data3D(i,1) data3D(i,2) data3D(i,3) data3D(i,4) 0 0 0 0 -data2D(i,1)*data3D(i,1) -data2D(i,1)*data3D(i,2) -data2D(i,1)*data3D(i,3) -data2D(i,1)*data3D(i,4)];
    A(k+1,:) = [0 0 0 0 data3D(i,1) data3D(i,2) data3D(i,3) data3D(i,4)  -data2D(i,2)*data3D(i,1) -data2D(i,2)*data3D(i,2) -data2D(i,2)*data3D(i,3) -data2D(i,2)*data3D(i,4)];
    k=k+2;
end

[U,S,V]=svd(A,0);
mnorm = ones(3,4);
mnorm(1,:) = V(1:4,12);
mnorm(2,:) = V(5:8,12);
mnorm(3,:) = V(9:12,12);

mnorm
for i=1:nbPoints
    test2D = mnorm*data3D(i,:)';
    test2D = test2D.*(1/test2D(3));
    Diff = test2D'-data2D(i,:);

    Res(i)=sqrt(Diff(1)^2+Diff(2)^2);
end
%%
C = -1*inv(mnorm(1:3,1:3))*mnorm(:,4)
